#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <assert.h>
#include <unistd.h>
#include <wchar.h>

#include "file_test.h"


static void run_ascii_test(){

    char *filename = "myfile775384905723345.txt";

    //create a temp file and close it
        char *file_contents = "Hi, I'm file contents.";
        FILE *file = fopen( filename, "w+" );
        fwrite( file_contents, sizeof(char), strlen(file_contents), file );
        fclose( file );

    //open the temp file for reading and use "file_get_contents"
        FILE *file2 = fopen( filename, "r+" );
        wide_char **string_ptr = malloc( sizeof(wide_char*) );
        file_get_contents( string_ptr, file2 );
        fclose( file2 );

    //ensure that it's the same as what I had put in
        //assert( strcmp(file_contents,*string_ptr) == 0 );

    //cleanup
        unlink( filename );
        free( *string_ptr );
        free( string_ptr );

}



static void run_unicode_test(){

    char *source_filename = "test/test_files/utf8_two_lines.txt";
    char *destination_filename = "test/test_files/utf8_two_lines_destination.txt";

    //open the source file for reading and use "file_get_contents"
        FILE *file1 = fopen( source_filename, "r+" );
        wide_char *string_ptr;
        size_t number_of_characters = file_get_contents( &string_ptr, file1 );
        fclose( file1 );

    //open the destination file for writing and write the contents
        FILE *file2 = fopen( destination_filename, "w+" );
        if( file2 == NULL ){
            printf( "Could not open destination file for writing: %s", destination_filename );
            exit(5);
        }
        fwrite( string_ptr, sizeof(wide_char), number_of_characters, file2 );
        fclose( file2 );
        //printf( "number of characters: %lu", number_of_characters );

        const unsigned char comparison_string[596] = {
            0xFF, 0xFE, 0x00, 0x00, 0x91, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0x92, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x93, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x94, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0x95, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0x96, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x97, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x98, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0x99, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0x9A, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x9B, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x9C, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0x9D, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0x9E, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x9F, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xA0, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xA1, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xA3, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xA4, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xA5, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xA6, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xA7, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xA8, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xA9, 0x03, 0x00, 0x00, 0x2E, 0x00, 0x00, 0x00,
            0x0D, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0xB1, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xB2, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xB3, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xB4, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xB5, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xB6, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xB7, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xB8, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xB9, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xBA, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xBB, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xBC, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xBD, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xBE, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xBF, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xC0, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xC1, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xC3, 0x03, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00,
            0xC2, 0x03, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xC4, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xC5, 0x03, 0x00, 0x00,
            0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xC6, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0xC7, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0xC8, 0x03, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xC9, 0x03, 0x00, 0x00,
            0x2E, 0x00, 0x00, 0x00
        };

        assert( number_of_characters == 149 );

    //ensure that it's the same as what I had put in
        assert( wcsncmp(string_ptr, (wide_char*)comparison_string, number_of_characters) == 0 );

    //cleanup
        free( string_ptr );

}





void file_run_tests(){

    printf( "Running tests for file... " );
    fflush( stdout );

    //run_ascii_test();
    run_unicode_test();

    printf( "Done\n" );
    fflush( stdout );

}
